{"schemaVersion":{"major":0,"minor":3,"patch":0},"kind":"article","metadata":{"roleHeading":"Article","title":"スコープ付き設定","modules":[{"name":"Env"}],"role":"article"},"seeAlsoSections":[{"identifiers":["doc:\/\/Env\/documentation\/Env\/GettingStarted"],"generated":true,"title":"使用例","anchor":"使用例"}],"variants":[{"paths":["\/documentation\/env\/scopedconfiguration"],"traits":[{"interfaceLanguage":"swift"}]}],"abstract":[{"type":"text","text":"キープレフィックスを持つ設定グループの定義方法を学びます。"}],"sections":[],"hierarchy":{"paths":[["doc:\/\/Env\/documentation\/Env"]]},"primaryContentSections":[{"kind":"content","content":[{"anchor":"%E6%A6%82%E8%A6%81","text":"概要","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"関連する設定をグループ化する場合、"},{"type":"codeVoice","code":"@Env(scope:)"},{"type":"text","text":" を使用して"},{"type":"text","text":" "},{"type":"text","text":"キープレフィックスを指定できます。"}],"type":"paragraph"},{"anchor":"%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9","text":"スコープの使い方","level":2,"type":"heading"},{"anchor":"%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E4%BB%98%E3%81%8D%E8%A8%AD%E5%AE%9A%E3%81%AE%E5%AE%9A%E7%BE%A9","text":"スコープ付き設定の定義","level":3,"type":"heading"},{"code":["import Env","","@Env(scope: \"emulator\")","struct EmulatorConfig {","    @Value(\"firestore.host\", default: \"localhost\")","    var firestoreHost: String","","    @Value(\"firestore.port\", default: 8090)","    var firestorePort: Int","","    @Value(\"auth.host\", default: \"localhost\")","    var authHost: String","","    @Value(\"auth.port\", default: 9099)","    var authPort: Int","}"],"syntax":"swift","type":"codeListing"},{"anchor":"%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%A8%E3%81%AE%E5%AF%BE%E5%BF%9C","text":"環境変数との対応","level":3,"type":"heading"},{"inlineContent":[{"type":"codeVoice","code":"scope: \"emulator\""},{"type":"text","text":" を指定すると、以下のように環境変数名が生成されます："}],"type":"paragraph"},{"header":"row","type":"table","rows":[[[{"inlineContent":[{"type":"text","text":"キー"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"text":"環境変数名","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"firestore.host","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"code":"EMULATOR_FIRESTORE_HOST","type":"codeVoice"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"firestore.port","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"code":"EMULATOR_FIRESTORE_PORT","type":"codeVoice"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"auth.host"}]}],[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"EMULATOR_AUTH_HOST"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"auth.port"}]}],[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"EMULATOR_AUTH_PORT"}]}]]]},{"anchor":"%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95","text":"使用方法","level":3,"type":"heading"},{"code":["let config = ConfigReader(provider: EnvironmentVariablesProvider())","","\/\/ root config を渡す（スコープは内部で処理される）","let emulator = EmulatorConfig(config: config)","","print(\"Firestore: \\(emulator.firestoreHost):\\(emulator.firestorePort)\")","print(\"Auth: \\(emulator.authHost):\\(emulator.authPort)\")"],"syntax":"swift","type":"codeListing"},{"anchor":"%E5%B1%95%E9%96%8B%E3%81%95%E3%82%8C%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89","text":"展開されるコード","level":2,"type":"heading"},{"inlineContent":[{"code":"@Env(scope: \"emulator\")","type":"codeVoice"},{"type":"text","text":" は以下のようなコードを生成します："}],"type":"paragraph"},{"code":["struct EmulatorConfig {","    var firestoreHost: String","    var firestorePort: Int","    var authHost: String","    var authPort: Int","","    private enum Keys {","        static let firestoreHost: ConfigKey = \"firestore.host\"","        static let firestorePort: ConfigKey = \"firestore.port\"","        static let authHost: ConfigKey = \"auth.host\"","        static let authPort: ConfigKey = \"auth.port\"","    }","","    private enum Defaults {","        static let firestoreHost = \"localhost\"","        static let firestorePort = 8090","        static let authHost = \"localhost\"","        static let authPort = 9099","    }","","    public init(config: ConfigReader) {","        let scopedConfig = config.scoped(to: \"emulator\")","        self.firestoreHost = scopedConfig.string(forKey: Keys.firestoreHost, default: Defaults.firestoreHost)","        self.firestorePort = scopedConfig.int(forKey: Keys.firestorePort, default: Defaults.firestorePort)","        self.authHost = scopedConfig.string(forKey: Keys.authHost, default: Defaults.authHost)","        self.authPort = scopedConfig.int(forKey: Keys.authPort, default: Defaults.authPort)","    }","}","","extension EmulatorConfig: Sendable {}"],"syntax":"swift","type":"codeListing"},{"anchor":"%E8%A4%87%E6%95%B0%E8%A8%AD%E5%AE%9A%E3%81%AE%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B","level":2,"type":"heading","text":"複数設定の組み合わせ"},{"code":["@Env","struct GCPConfig {","    @Value(\"gcp.project.id\", default: \"stockle-app\")","    var projectId: String","","    @Value(\"firebase.emulator\", default: false)","    var useEmulator: Bool","}","","@Env(scope: \"emulator\")","struct EmulatorConfig {","    @Value(\"firestore.host\", default: \"localhost\")","    var firestoreHost: String","","    @Value(\"firestore.port\", default: 8090)","    var firestorePort: Int","}","","\/\/ 使用例","let config = ConfigReader(provider: EnvironmentVariablesProvider())","let gcp = GCPConfig(config: config)","let emulator = EmulatorConfig(config: config)","","if gcp.useEmulator {","    print(\"Emulator: \\(emulator.firestoreHost):\\(emulator.firestorePort)\")","} else {","    print(\"Production: \\(gcp.projectId)\")","}"],"syntax":"swift","type":"codeListing"}]}],"identifier":{"url":"doc:\/\/Env\/documentation\/Env\/ScopedConfiguration","interfaceLanguage":"swift"},"references":{"doc://Env/documentation/Env/GettingStarted":{"title":"はじめに","role":"article","identifier":"doc:\/\/Env\/documentation\/Env\/GettingStarted","abstract":[{"text":"環境変数設定を宣言的に定義する方法を学びます。","type":"text"}],"type":"topic","url":"\/documentation\/env\/gettingstarted","kind":"article"},"doc://Env/documentation/Env":{"identifier":"doc:\/\/Env\/documentation\/Env","type":"topic","abstract":[{"type":"text","text":"Swiftマクロによる環境変数設定の宣言的アクセス。"}],"url":"\/documentation\/env","role":"collection","title":"Env","kind":"symbol"}}}